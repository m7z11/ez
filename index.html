<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ‚Ø¹ ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --card-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --shadow-color: rgba(0,0,0,0.1);
            --input-bg: white;
        }
        body.dark-mode {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --card-bg: #0f3460;
            --text-color: #eaeaea;
            --border-color: #533483;
            --shadow-color: rgba(0,0,0,0.5);
            --input-bg: #1a1a2e;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
            transition: all 0.3s ease;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; color: white; margin-bottom: 30px; animation: fadeInDown 0.6s ease; }
        h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .top-buttons { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000; }
        .menu-btn, .dark-mode-btn { background: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 1.2em; box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: transform 0.2s; }
        body.dark-mode .menu-btn, body.dark-mode .dark-mode-btn { background: var(--card-bg); color: var(--text-color); }
        .menu-btn:hover, .dark-mode-btn:hover { transform: scale(1.05); }
        .sidebar { position: fixed; top: 0; right: -300px; width: 300px; height: 100%; background: white; box-shadow: -2px 0 10px rgba(0,0,0,0.3); transition: right 0.3s ease; z-index: 999; overflow-y: auto; padding: 20px; }
        body.dark-mode .sidebar { background: var(--card-bg); color: var(--text-color); }
        .sidebar.active { right: 0; }
        .sidebar h3 { margin-bottom: 20px; color: #667eea; }
        body.dark-mode .sidebar h3 { color: #a78bfa; }
        .sidebar button { width: 100%; padding: 12px; margin-bottom: 10px; border: none; border-radius: 8px; background: #667eea; color: white; cursor: pointer; font-size: 1em; transition: all 0.3s; }
        .sidebar button:hover { background: #764ba2; transform: translateX(-5px); }
        .card { background: var(--card-bg); color: var(--text-color); border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 16px var(--shadow-color); transition: transform 0.3s; animation: fadeInUp 0.5s ease; }
        .card:hover { transform: translateY(-5px); }
        .level-selector { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .level-btn { padding: 10px 20px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--card-bg); color: var(--text-color); cursor: pointer; font-size: 1em; transition: all 0.3s; }
        .level-btn:hover { transform: scale(1.05); }
        .level-btn.active { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .level-A1 { border-color: #4CAF50; }
        .level-A1.active { background: #4CAF50; color: white; }
        .level-A2 { border-color: #2196F3; }
        .level-A2.active { background: #2196F3; color: white; }
        .level-B1 { border-color: #FF9800; }
        .level-B1.active { background: #FF9800; color: white; }
        .level-B2 { border-color: #9C27B0; }
        .level-B2.active { background: #9C27B0; color: white; }
        .level-C1 { border-color: #FFD700; }
        .level-C1.active { background: linear-gradient(135deg, #FFD700, #FFA500); color: white; }
        input, button { padding: 12px; border-radius: 8px; border: 2px solid var(--border-color); font-size: 1em; margin: 5px; background: var(--input-bg); color: var(--text-color); transition: all 0.3s; }
        input { width: calc(50% - 10px); }
        input.error { border-color: #f44336; animation: shake 0.5s; }
        button { background: #667eea; color: white; border: none; cursor: pointer; }
        button:hover:not(:disabled) { background: #764ba2; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .stats { display: flex; justify-content: space-around; gap: 15px; flex-wrap: wrap; }
        .stat-box { flex: 1; min-width: 150px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        body.dark-mode .stat-box { background: linear-gradient(135deg, #533483, #7e22ce); }
        .stat-box h3 { font-size: 2em; margin-bottom: 5px; }
        .test-area { text-align: center; }
        .test-question { font-size: 1.5em; margin: 20px 0; color: var(--text-color); }
        .test-input { width: 80%; padding: 15px; font-size: 1.2em; text-align: center; border: 3px solid #667eea; }
        .test-input:focus { outline: none; border-color: #764ba2; box-shadow: 0 0 15px rgba(102, 126, 234, 0.5); transform: scale(1.02); }
        .test-input:disabled { opacity: 0.6; cursor: not-allowed; }
        .result { padding: 15px; margin: 15px 0; border-radius: 8px; font-size: 1.1em; animation: bounceIn 0.5s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .correct { background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: 2px solid #2e7d32; }
        .incorrect { background: linear-gradient(135deg, #f44336, #e53935); color: white; border: 2px solid #c62828; }
        .incorrect strong { background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 5px; display: inline-block; margin-top: 10px; }
        .test-type-selector { display: flex; gap: 10px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .test-btn { padding: 15px 25px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; transition: all 0.3s; }
        .test-btn:hover { background: #764ba2; transform: scale(1.05); }
        .hidden { display: none; }
        .progress-bar { width: 100%; height: 20px; background: var(--border-color); border-radius: 10px; overflow: hidden; margin: 20px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4CAF50, #2196F3); transition: width 0.3s; }
        .reset-btn { background: #f44336 !important; }
        .reset-btn:hover { background: #d32f2f !important; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--card-bg); color: var(--text-color); padding: 30px; border-radius: 15px; max-width: 500px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .modal-content h2 { margin-bottom: 20px; color: #f44336; }
        .modal-content p { margin-bottom: 25px; font-size: 1.1em; }
        .modal-buttons { display: flex; gap: 15px; justify-content: center; }
        .modal-buttons button { padding: 12px 30px; font-size: 1.1em; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.5); } 50% { transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        @media (max-width: 768px) { h1 { font-size: 1.8em; } input { width: 100%; } .stats { flex-direction: column; } .top-buttons { top: 10px; right: 10px; } }
    </style>
</head>
<body>
    <div class="top-buttons">
        <button class="dark-mode-btn" onclick="toggleDarkMode()">ğŸŒ™</button>
        <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
    </div>
    <div class="sidebar" id="sidebar">
        <h3>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
        <button onclick="showPage('add')">ğŸ“ Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø§Øª</button>
        <button onclick="showPage('test')">ğŸ“Š Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
        <button onclick="showPage('errors')">âŒ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</button>
        <button onclick="showPage('stats')">ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        <button onclick="showResetModal()" class="reset-btn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø´Ø§Ù…Ù„Ø©</button>
    </div>
    <div class="modal" id="reset-modal">
        <div class="modal-content">
            <h2>âš ï¸ ØªØ­Ø°ÙŠØ±!</h2>
            <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹ØŸ</p>
            <p><strong>Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ</strong></p>
            <div class="modal-buttons">
                <button onclick="hideResetModal()" style="background: #4CAF50;">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="confirmReset()" class="reset-btn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</button>
            </div>
        </div>
    </div>
    <div class="container">
        <header>
            <h1>ğŸ“š Ù…ÙˆÙ‚Ø¹ ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</h1>
            <p>ØªØ¹Ù„Ù… ÙˆØªØ¯Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
        </header>
        <div id="page-add" class="page">
            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <div class="level-selector">
                    <button class="level-btn level-A1 active" onclick="selectLevel('A1')">A1</button>
                    <button class="level-btn level-A2" onclick="selectLevel('A2')">A2</button>
                    <button class="level-btn level-B1" onclick="selectLevel('B1')">B1</button>
                    <button class="level-btn level-B2" onclick="selectLevel('B2')">B2</button>
                    <button class="level-btn level-C1" onclick="selectLevel('C1')">ğŸ‘‘ C1</button>
                </div>
                <input type="text" id="englishWord" placeholder="Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ">
                <input type="text" id="arabicWord" placeholder="Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ">
                <button onclick="addWord()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø©</button>
                <p id="addMessage"></p>
            </div>
        </div>
        <div id="page-test" class="page hidden">
            <div class="card">
                <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
                <div class="level-selector">
                    <button class="level-btn level-A1" onclick="selectTestLevel('A1')">A1</button>
                    <button class="level-btn level-A2" onclick="selectTestLevel('A2')">A2</button>
                    <button class="level-btn level-B1" onclick="selectTestLevel('B1')">B1</button>
                    <button class="level-btn level-B2" onclick="selectTestLevel('B2')">B2</button>
                    <button class="level-btn level-C1" onclick="selectTestLevel('C1')">ğŸ‘‘ C1</button>
                </div>
                <div id="test-options" class="hidden">
                    <h3>Ø§Ø®ØªØ± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ±Ø¬Ù…Ø©:</h3>
                    <div class="test-type-selector">
                        <button class="test-btn" onclick="selectDirection('ar-en')" style="background: #4CAF50;">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ â†’ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ğŸ‡¬ğŸ‡§</button>
                        <button class="test-btn" onclick="selectDirection('en-ar')" style="background: #2196F3;">ğŸ‡¬ğŸ‡§ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ â†’ Ø¹Ø±Ø¨ÙŠ ğŸ‡¸ğŸ‡¦</button>
                        <button class="test-btn" onclick="selectDirection('random')" style="background: #FF9800;">ğŸ”€ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
                    </div>
                    <div id="test-types" class="hidden">
                        <h3 style="margin-top: 20px;">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
                        <div class="test-type-selector">
                            <button class="test-btn" onclick="startTest('short', 1)">Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ± 1</button>
                            <button class="test-btn" onclick="startTest('short', 2)">Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ± 2</button>
                            <button class="test-btn" onclick="startTest('short', 3)">Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ± 3</button>
                            <button class="test-btn" onclick="startTest('short', 4)">Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ± 4</button>
                            <button class="test-btn" onclick="startTest('final', 0)">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card test-area hidden" id="test-card">
                <h2 id="test-title">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
                <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
                <p id="question-counter"></p>
                <div class="test-question" id="question"></div>
                <input type="text" class="test-input" id="answer" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§">
                <div>
                    <button id="check-btn" onclick="checkAnswer()">ØªØ­Ù‚Ù‚</button>
                    <button onclick="skipQuestion()">ØªØ¬Ø§ÙˆØ²</button>
                    <button onclick="nextQuestion()" class="hidden" id="next-btn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                </div>
                <div id="result"></div>
            </div>
        </div>
        <div id="page-errors" class="page hidden">
            <div class="card">
                <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</h2>
                <button onclick="testErrors()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</button>
                <div id="errors-list"></div>
            </div>
        </div>
        <div id="page-stats" class="page hidden">
            <div class="card">
                <h2>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
                <div class="stats">
                    <div class="stat-box"><h3 id="total-words">0</h3><p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</p></div>
                    <div class="stat-box"><h3 id="correct-answers">0</h3><p>Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©</p></div>
                    <div class="stat-box"><h3 id="wrong-answers">0</h3><p>Ø¥Ø¬Ø§Ø¨Ø§Øª Ø®Ø§Ø·Ø¦Ø©</p></div>
                </div>
                <div id="level-stats"></div>
            </div>
        </div>
    </div>
    <script>
        let words = {}, errors = [], stats = { correct: 0, wrong: 0 }, currentTest = [], currentIndex = 0, currentLevel = 'A1', testLevel = '', testDirection = 'ar-en', selectedDirection = 'random';
        function loadData() {
            const stored = localStorage.getItem('englishApp');
            if (stored) { const data = JSON.parse(stored); words = data.words || {}; errors = data.errors || []; stats = data.stats || { correct: 0, wrong: 0 }; }
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'true') { document.body.classList.add('dark-mode'); document.querySelector('.dark-mode-btn').textContent = 'â˜€ï¸'; }
        }
        function saveData() { localStorage.setItem('englishApp', JSON.stringify({ words, errors, stats })); }
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); const isDark = document.body.classList.contains('dark-mode'); document.querySelector('.dark-mode-btn').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™'; localStorage.setItem('darkMode', isDark); }
        function selectLevel(level) { currentLevel = level; document.querySelectorAll('#page-add .level-selector .level-btn').forEach(btn => btn.classList.remove('active')); event.target.classList.add('active'); }
        function selectTestLevel(level) { testLevel = level; document.querySelectorAll('#page-test .level-selector .level-btn').forEach(btn => btn.classList.remove('active')); event.target.classList.add('active'); document.getElementById('test-options').classList.remove('hidden'); document.getElementById('test-types').classList.add('hidden'); }
        function selectDirection(direction) { selectedDirection = direction; document.getElementById('test-types').classList.remove('hidden'); }
        function addWord() {
            const eng = document.getElementById('englishWord').value.trim(), ara = document.getElementById('arabicWord').value.trim();
            const engInput = document.getElementById('englishWord'), araInput = document.getElementById('arabicWord'), msg = document.getElementById('addMessage');
            engInput.classList.remove('error'); araInput.classList.remove('error');
            if (!eng || !ara) { if (!eng) engInput.classList.add('error'); if (!ara) araInput.classList.add('error'); msg.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'; msg.style.color = '#f44336'; return; }
            if (!words[currentLevel]) words[currentLevel] = [];
            words[currentLevel].push({ english: eng, arabic: ara }); saveData(); engInput.value = ''; araInput.value = ''; msg.textContent = 'âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!'; msg.style.color = '#4CAF50'; setTimeout(() => msg.textContent = '', 3000); updateStats();
        }
        function normalizeText(text) { return text.trim().toLowerCase().replace(/\s+/g, ' ').replace(/[^\w\s\u0600-\u06FF]/g, ''); }
        function startTest(type, num) {
            if (!words[testLevel] || words[testLevel].length === 0) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰!'); return; }
            if (selectedDirection === 'random') { testDirection = Math.random() > 0.5 ? 'ar-en' : 'en-ar'; }
            else { testDirection = selectedDirection; }
            let allWords = [...words[testLevel]];
            if (type === 'short') { const start = (num - 1) * 60; currentTest = allWords.slice(start, start + 60); } else { currentTest = allWords; }
            currentTest = currentTest.sort(() => Math.random() - 0.5); currentIndex = 0;
            document.getElementById('test-card').classList.remove('hidden'); 
            let directionText = testDirection === 'ar-en' ? 'ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ â†’ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ğŸ‡¬ğŸ‡§' : 'ğŸ‡¬ğŸ‡§ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ â†’ Ø¹Ø±Ø¨ÙŠ ğŸ‡¸ğŸ‡¦';
            document.getElementById('test-title').textContent = (type === 'short' ? 'Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ± ' + num : 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ') + ' - ' + directionText;
            showQuestion();
        }
        function showQuestion() {
            if (currentIndex >= currentTest.length) {
                document.getElementById('question').innerHTML = '<h2>ğŸ‰ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!</h2><p style="font-size: 1.2em; margin-top: 20px;">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</p>';
                document.getElementById('answer').classList.add('hidden'); document.getElementById('check-btn').classList.add('hidden');
                document.querySelector('#test-card button[onclick="skipQuestion()"]').classList.add('hidden'); document.getElementById('next-btn').classList.add('hidden'); return;
            }
            const word = currentTest[currentIndex], q = document.getElementById('question');
            if (testDirection === 'ar-en') { q.innerHTML = '<strong>ØªØ±Ø¬Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©:</strong><br><span style="font-size: 1.3em; color: #667eea;">' + word.arabic + '</span>'; }
            else { q.innerHTML = '<strong>ØªØ±Ø¬Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:</strong><br><span style="font-size: 1.3em; color: #667eea;">' + word.english + '</span>'; }
            const answerInput = document.getElementById('answer');
            answerInput.value = ''; answerInput.classList.remove('hidden'); answerInput.disabled = false; answerInput.focus();
            document.getElementById('result').innerHTML = ''; document.getElementById('next-btn').classList.add('hidden');
            const checkBtn = document.getElementById('check-btn'), skipBtn = document.querySelector('#test-card button[onclick="skipQuestion()"]');
            checkBtn.classList.remove('hidden'); skipBtn.classList.remove('hidden'); checkBtn.disabled = false; updateProgress();
        }
        function checkAnswer() {
            const word = currentTest[currentIndex], userAnswer = document.getElementById('answer').value;
            const normalizedUserAnswer = normalizeText(userAnswer);
            const normalizedCorrect = testDirection === 'ar-en' ? normalizeText(word.english) : normalizeText(word.arabic);
            const correctAnswer = testDirection === 'ar-en' ? word.english : word.arabic, result = document.getElementById('result');
            const isCorrect = normalizedUserAnswer === normalizedCorrect;
            if (isCorrect) { result.innerHTML = '<div class="result correct">âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!</div>'; stats.correct++; }
            else { result.innerHTML = '<div class="result incorrect">âŒ Ø®Ø·Ø£! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: <strong>' + correctAnswer + '</strong></div>'; stats.wrong++; if (!errors.find(e => e.english === word.english && e.arabic === word.arabic)) errors.push(word); }
            saveData(); updateStats(); document.getElementById('next-btn').classList.remove('hidden'); document.getElementById('check-btn').disabled = true;
        }
        function skipQuestion() { nextQuestion(); }
        function nextQuestion() { currentIndex++; showQuestion(); }
        function updateProgress() { const percent = ((currentIndex + 1) / currentTest.length) * 100; document.getElementById('progress').style.width = percent + '%'; document.getElementById('question-counter').textContent = 'Ø§Ù„Ø³Ø¤Ø§Ù„ ' + (currentIndex + 1) + ' Ù…Ù† ' + currentTest.length; }
        function testErrors() {
            if (errors.length === 0) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡!'); return; }
            currentTest = [...errors].sort(() => Math.random() - 0.5); currentIndex = 0; 
            if (selectedDirection === 'random') { testDirection = Math.random() > 0.5 ? 'ar-en' : 'en-ar'; }
            else { testDirection = selectedDirection; }
            showPage('test'); document.getElementById('test-card').classList.remove('hidden'); 
            let directionText = testDirection === 'ar-en' ? 'ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ â†’ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ğŸ‡¬ğŸ‡§' : 'ğŸ‡¬ğŸ‡§ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ â†’ Ø¹Ø±Ø¨ÙŠ ğŸ‡¸ğŸ‡¦';
            document.getElementById('test-title').textContent = 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ - ' + directionText; 
            showQuestion();
        }
        function updateStats() {
            let total = 0; for (let level in words) total += words[level].length;
            document.getElementById('total-words').textContent = total; document.getElementById('correct-answers').textContent = stats.correct; document.getElementById('wrong-answers').textContent = stats.wrong;
            const errorsList = document.getElementById('errors-list');
            if (errors.length === 0) errorsList.innerHTML = '<p style="text-align: center; color: #4CAF50; font-size: 1.2em;">ğŸ‰ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡! Ù…Ù…ØªØ§Ø²!</p>';
            else errorsList.innerHTML = '<div style="margin-top: 20px;">' + errors.map(e => '<div style="background: var(--input-bg); padding: 15px; margin: 10px 0; border-radius: 8px; border-right: 4px solid #f44336;"><strong style="color: #667eea;">' + e.english + '</strong> <span style="margin: 0 10px;">â†â†’</span> <strong style="color: #764ba2;">' + e.arabic + '</strong></div>').join('') + '</div>';
            const levelStats = document.getElementById('level-stats'); let html = '<h3 style="margin-top: 30px; margin-bottom: 20px;">ğŸ“Š ÙƒÙ„Ù…Ø§Øª ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰:</h3>';
            const levels = ['A1', 'A2', 'B1', 'B2', 'C1'], levelColors = { 'A1': '#4CAF50', 'A2': '#2196F3', 'B1': '#FF9800', 'B2': '#9C27B0', 'C1': '#FFD700' };
            levels.forEach(level => { const count = words[level] ? words[level].length : 0; html += '<div style="background: var(--input-bg); padding: 15px; margin: 10px 0; border-radius: 8px; border-right: 5px solid ' + levelColors[level] + '; display: flex; justify-content: space-between; align-items: center;"><strong style="font-size: 1.2em;">' + level + '</strong><span style="background: ' + levelColors[level] + '; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;">' + count + ' ÙƒÙ„Ù…Ø©</span></div>'; });
            levelStats.innerHTML = html;
        }
        function showResetModal() { document.getElementById('reset-modal').classList.add('active'); toggleMenu(); }
        function hideResetModal() { document.getElementById('reset-modal').classList.remove('active'); }
        function confirmReset() { words = {}; errors = []; stats = { correct: 0, wrong: 0 }; localStorage.removeItem('englishApp'); updateStats(); document.getElementById('englishWord').value = ''; document.getElementById('arabicWord').value = ''; document.getElementById('test-card').classList.add('hidden'); hideResetModal(); showPage('add'); const msg = document.getElementById('addMessage'); msg.textContent = 'âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹ Ø¨Ù†Ø¬Ø§Ø­!'; msg.style.color = '#4CAF50'; setTimeout(() => msg.textContent = '', 3000); }
        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }
        function showPage(page) { document.querySelectorAll('.page').forEach(p => p.classList.add('hidden')); document.getElementById('page-' + page).classList.remove('hidden'); toggleMenu(); updateStats(); }
        document.getElementById('answer').addEventListener('keypress', function(e) { if (e.key === 'Enter') { const nextBtn = document.getElementById('next-btn'); if (!nextBtn.classList.contains('hidden')) nextQuestion(); else checkAnswer(); } });
        loadData(); updateStats();
    </script>
</body>
</html>